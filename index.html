<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ñ AI Across Domains Quizüéâ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 3H5C3.89543 3 3 3.89543 3 5V8M21 8V5C21 3.89543 20.1046 3 19 3H16M16 21H19C20.1046 21 21 20.1046 21 19V16M3 16V19C3 20.1046 3.89543 21 5 21H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    <div class="quiz-container">
        <div class="language-toggle" id="languageToggle">
            <button class="lang-btn" id="langBtnDE" onclick="switchLanguage('de')" title="Deutsch">
                <img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f1e9-1f1ea.svg" alt="üá©üá™" class="flag-icon">
            </button>
            <button class="lang-btn" id="langBtnEN" onclick="switchLanguage('en')" title="English">
                <img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f1ec-1f1e7.svg" alt="üá¨üáß" class="flag-icon">
            </button>
        </div>
        <div class="header">
            <h1 class="title">üéØ Modul 7 Post-Test üéØ</h1>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 / 0</div>
            </div>
        </div>

        <div class="quiz-content" id="quizContent">
            <div class="card-container">
                <div class="card-inner" id="cardInner">
                    <!-- Front of card - Nickname screen -->
                    <div class="card-front nickname-screen" id="nicknameScreen">
                        <h2 class="nickname-title">Wie hei√üt Du? üéÆ</h2>
                        <input type="text" id="nicknameInput" class="nickname-input" placeholder="Wie hei√üt Du?" maxlength="20">
                        <button class="nickname-submit-btn" id="nicknameSubmitBtn">Quiz starten! üöÄ</button>
                    </div>
                    <!-- Back of card - Credits screen -->
                    <div class="card-back credits-screen" id="creditsScreen" style="display: none;">
                        <div class="credits-content">
                            <p class="credits-top" id="creditsTop"></p>
                            <p class="credits-text" id="creditsText">Entwickelt mit ‚ù§Ô∏è von Hyunchang Oh f√ºr AI Across Domains 2025/2026 WS</p>
                            <div class="credits-list" id="creditsList">
                                <p>Cursor AI f√ºr die Frontend Implementation</p>
                                <p>Gemini f√ºr die Backend Implementation</p>
                            </div>
                            <div class="credits-bottom" id="creditsBottom">
                                <p class="credits-bottom-text"></p>
                                <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" class="credits-license-link"></a>
                            </div>
                        </div>
                        <a href="#" class="back-link" id="backLink" onclick="event.preventDefault(); flipToQuiz();">Zur√ºck zum Quiz</a>
                    </div>
                </div>
                <!-- Credits link positioned at bottom right corner of card container -->
                <a href="#" class="credits-link" id="creditsLink" onclick="event.preventDefault(); flipToCredits();">KI-Systeme, die f√ºr das Quiz verwendet wurden</a>
            </div>
            <div class="start-screen" id="startScreen" style="display: none;">
                <div class="loading-container" id="loadingContainer">
                    <div class="loading-bar-container">
                        <div class="loading-bar-fill" id="loadingBarFill"></div>
                    </div>
                    <div class="loading-text">Dein Quiz wird vorbereitet... üé®</div>
                </div>
                <button class="start-btn" id="startBtn" style="display: none;">Los geht's! üöÄ</button>
            </div>
        </div>

        <div class="celebration" id="celebration">
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="celebration-text">üéâ Richtig! üéâ</div>
        </div>

        <div class="battle-animation" id="battleAnimation" style="display: none;">
            <div class="sunrise-container">
                <div class="sun"></div>
                <div class="sunrise-text">Der letzte Kampf beginnt...</div>
            </div>
            <div class="battle-field">
                <div class="unicorn-army" id="unicornArmy"></div>
                <div class="poop-army" id="poopArmy"></div>
            </div>
            <div class="victory-winner" id="victoryWinner" style="display: none;">
                <div class="winner-emoji" id="winnerEmoji"></div>
                <div class="winner-text" id="winnerText"></div>
            </div>
            <button class="next-to-results-btn" id="nextToResultsBtn" onclick="showResults()" style="display: none;">Ergebnisse anzeigen ‚Üí</button>
        </div>

        <div class="results" id="results" style="display: none;">
            <h2>Quiz abgeschlossen! üéä</h2>
            <div class="score-display" id="scoreDisplay"></div>
            <button class="download-btn" id="downloadBtn" onclick="downloadResults()">Ergebnisse herunterladen üì•</button>
            <a href="#" class="credits-link-results" id="creditsLinkResults" onclick="event.preventDefault(); showCreditsFromResults();">KI-Systeme, die f√ºr das Quiz verwendet wurden</a>
        </div>
    </div>


    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDbsC2-JAVaMPJ1P5MXUzGNFocO1ckYW1s",
          authDomain: "enkis-fakahoot.firebaseapp.com",
          projectId: "enkis-fakahoot",
          storageBucket: "enkis-fakahoot.firebasestorage.app",
          messagingSenderId: "472090260372",
          appId: "1:472090260372:web:3970ed2ce2e8274752d581",
          measurementId: "G-Q0E9HS1551"
        };
      
        // Initialize Firebase with comprehensive error handling
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase App initialized:', app.name);
            
            // Initialize Analytics (non-critical - wrap in try-catch so it doesn't break Firestore)
            try {
                const analytics = getAnalytics(app);
                console.log('‚úÖ Analytics initialized');
            } catch (analyticsError) {
                console.warn('‚ö†Ô∏è Analytics initialization failed (non-critical):', analyticsError.message);
                console.warn('  - This is often caused by ad blockers blocking Google Tag Manager');
                console.warn('  - Firestore will still work normally');
                // Continue - analytics failure shouldn't break the app
            }
            
            // Initialize Firestore (critical - must succeed)
            db = getFirestore(app);
            console.log('‚úÖ Firestore database initialized');
            console.log('üìä Firestore instance:', db);
            console.log('üîë Project ID:', firebaseConfig.projectId);
            console.log('üåê API Key:', firebaseConfig.apiKey.substring(0, 10) + '...');
            
            // Verify Firestore is ready
            if (!db) {
                throw new Error('Firestore database object is null or undefined');
            }
            
        } catch (initError) {
            console.error('‚ùå CRITICAL: Firebase initialization failed!', initError);
            console.error('Error details:', {
                name: initError.name,
                message: initError.message,
                stack: initError.stack
            });
            alert('Firebase initialization failed. Check console for details.');
            throw initError;
        }
        
        // Make Firebase functions available globally
        window.firebaseDB = db;
        window.firebaseAddDoc = addDoc;
        window.firebaseCollection = collection;
        window.firebaseApp = app;
        
        // Comprehensive Firebase status check function
        window.checkFirebaseStatus = function() {
            console.log('üîç Firebase Status Check:');
            console.log('  - App initialized:', !!app);
            console.log('  - Firestore DB:', !!db);
            console.log('  - addDoc function:', typeof addDoc === 'function');
            console.log('  - collection function:', typeof collection === 'function');
            console.log('  - window.firebaseDB:', !!window.firebaseDB);
            console.log('  - window.firebaseAddDoc:', typeof window.firebaseAddDoc === 'function');
            console.log('  - window.firebaseCollection:', typeof window.firebaseCollection === 'function');
            console.log('  - Project ID:', firebaseConfig.projectId);
            return {
                appInitialized: !!app,
                dbInitialized: !!db,
                functionsAvailable: !!(window.firebaseDB && window.firebaseAddDoc && window.firebaseCollection)
            };
        };
        
        // Enhanced test function to verify Firebase connectivity
        window.testFirebase = async function() {
            console.log('üß™ Testing Firebase connection...');
            console.log('üìã Test data will be written to: quizAnswers collection');
            
            // First check status
            const status = window.checkFirebaseStatus();
            if (!status.functionsAvailable) {
                console.error('‚ùå Firebase functions not available!');
                return false;
            }
            
            try {
                const testData = {
                    test: true,
                    timestamp: new Date(),
                    message: 'Test connection from browser',
                    testId: 'test-' + Date.now()
                };
                
                console.log('üì§ Sending test data:', testData);
                const startTime = Date.now();
                
                const docRef = await addDoc(collection(db, 'quizAnswers'), testData);
                
                const duration = Date.now() - startTime;
                console.log('‚úÖ Firebase test successful!');
                console.log('  - Document ID:', docRef.id);
                console.log('  - Response time:', duration + 'ms');
                console.log('  - Full document reference:', docRef);
                
                // Verify the document was actually written by checking network
                console.log('üí° Check the Network tab in DevTools for Firestore API calls');
                console.log('üí° Check Firestore Console: https://console.firebase.google.com/project/' + firebaseConfig.projectId + '/firestore');
                
                return { success: true, docId: docRef.id, duration: duration };
            } catch (error) {
                console.error('‚ùå Firebase test failed!');
                console.error('  - Error name:', error.name);
                console.error('  - Error code:', error.code);
                console.error('  - Error message:', error.message);
                console.error('  - Full error object:', error);
                
                // Detailed error analysis
                if (error.code) {
                    const errorCodes = {
                        'permission-denied': 'Security rules are blocking the write. Check firestore.rules',
                        'unavailable': 'Firestore service is unavailable. Check internet connection.',
                        'failed-precondition': 'Database not initialized or in wrong mode.',
                        'invalid-argument': 'Invalid data format or missing required fields.',
                        'deadline-exceeded': 'Request timed out. Check network connection.',
                        'not-found': 'Collection or document path not found.',
                        'already-exists': 'Document already exists (should not happen with addDoc).',
                        'resource-exhausted': 'Quota exceeded or too many requests.',
                        'aborted': 'Operation was aborted.',
                        'out-of-range': 'Value out of range.',
                        'unimplemented': 'Operation not implemented.',
                        'internal': 'Internal Firestore error.',
                        'unauthenticated': 'Authentication required.',
                        'data-loss': 'Data corruption detected.'
                    };
                    
                    const errorExplanation = errorCodes[error.code] || 'Unknown error code';
                    console.error('  - Error explanation:', errorExplanation);
                }
                
                return { success: false, error: error };
            }
        };
        
        console.log('üí° Firebase diagnostic functions available:');
        console.log('  - checkFirebaseStatus() - Check if Firebase is properly initialized');
        console.log('  - testFirebase() - Test writing to Firestore');
      </script>
    <script src="script.js"></script>
</body>
</html>

